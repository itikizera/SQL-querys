--SINTETICOSELECT
SELECT EMP='01', C5_FILIAL,C5_LOCADO TP_NEGOCIO, SUBSTRING(C.X5_DESCRI,1,40) TP_NEG_DESC,C5_ICBCN CANAL_NEG, D.X5_DESCRI CANAL_DESC,
C6_TIPOOP TP_OP, E.X5_DESCRI TP_OP_DESC,
CONVERT(VARCHAR , CAST ( MAX(C5_EMISSAO)  AS DATETIME ), 103 )ULT_EMISSAO, C5_TABELA, DA0_DESCRI, 
C6_TES, F4_TEXTO, F4_DUPLIC, F4_ESTOQUE, F4_PODER3, COUNT(C5_LOCADO+C5_ICBCN+C6_TIPOOP+C5_TABELA+C6_TES)TOTAL,
ISNULL((SELECT COUNT(*) FROM (SELECT C5_FILIAL, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES FROM SC5010 C5X 
INNER JOIN SC6010 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1010 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM 
AND E1X.D_E_L_E_T_='' AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA<>'' OR E1X.E1_SALDO=0)
and (E1_PARCELA='' OR E1_PARCELA='A')
WHERE C5X.D_E_L_E_T_='' 
and C5X.C5_FILIAL=A.C5_FILIAL and C5X.C5_LOCADO=A.C5_LOCADO and C5X.C5_ICBCN=A.C5_ICBCN and C5X.C5_TABELA=A.C5_TABELA 
and C6X.C6_TES=B.C6_TES and C6X.C6_TIPOOP=B.C6_TIPOOP
GROUP BY C5_FILIAL, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES) as TRB),'') AS FATURADO,
ISNULL((SELECT COUNT(*) FROM (SELECT C5_FILIAL, E1_NUM, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES, E1_VENCREA,
(Convert(nVarChar(8), GetDate()-30, 112))AS TST FROM SC5010 C5X 
INNER JOIN SC6010 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1010 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM AND C5X.D_E_L_E_T_='' AND E1X.D_E_L_E_T_=''
AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA='' OR E1X.E1_SALDO>0)
AND E1_VENCREA <= (Convert(nVarChar(8), GetDate()-30, 112))
and C5X.C5_FILIAL=A.C5_FILIAL and C5X.C5_LOCADO=A.C5_LOCADO and C5X.C5_ICBCN=A.C5_ICBCN and C5X.C5_TABELA=A.C5_TABELA 
and C6X.C6_TES=B.C6_TES and C6X.C6_TIPOOP=B.C6_TIPOOP
GROUP BY C5_FILIAL,C5_NUM,C5_LOCADO,C5_ICBCN,C6_TIPOOP, C6_TES, C5_TABELA,E1_VENCREA, E1_NUM)TRB),'') AS VENCIDO
FROM SC5010 A
INNER JOIN SC6010 B ON C5_FILIAL=C6_FILIAL AND C5_NUM=C6_NUM AND A.D_E_L_E_T_='' AND B.D_E_L_E_T_=''
INNER JOIN SX5010 C ON C.X5_TABELA='A6'AND C.X5_CHAVE=A.C5_LOCADO AND C.D_E_L_E_T_=''
INNER JOIN SX5010 D ON D.X5_TABELA='Z2'AND D.X5_CHAVE=A.C5_ICBCN AND D.D_E_L_E_T_=''
INNER JOIN SX5010 E ON E.X5_TABELA='ZE'AND E.X5_CHAVE=B.C6_TIPOOP AND E.D_E_L_E_T_=''
INNER JOIN SF4010 F ON F4_CODIGO=C6_TES AND F.D_E_L_E_T_=''
INNER JOIN DA0010 G ON DA0_CODTAB=C5_TABELA AND G.D_E_L_E_T_=''
WHERE C5_EMISSAO >= '20140101'
GROUP BY C5_FILIAL,C5_LOCADO,C5_ICBCN,C6_TIPOOP, C6_TES, C5_TABELA, C.X5_DESCRI, D.X5_DESCRI, E.X5_DESCRI,
F4_TEXTO, DA0_DESCRI, F4_DUPLIC, F4_ESTOQUE, F4_PODER3

UNION ALL

SELECT EMP='02', C5_FILIAL,C5_LOCADO TP_NEGOCIO, SUBSTRING(C.X5_DESCRI,1,40) TP_NEG_DESC,C5_ICBCN CANAL_NEG, D.X5_DESCRI CANAL_DESC,
C6_TIPOOP TP_OP, E.X5_DESCRI TP_OP_DESC,
CONVERT(VARCHAR , CAST ( MAX(C5_EMISSAO)  AS DATETIME ), 103 )ULT_EMISSAO, C5_TABELA, DA0_DESCRI, 
C6_TES, F4_TEXTO, F4_DUPLIC, F4_ESTOQUE, F4_PODER3, COUNT(C5_LOCADO+C5_ICBCN+C6_TIPOOP+C5_TABELA+C6_TES)TOTAL,
ISNULL((SELECT COUNT(*) FROM (SELECT C5_FILIAL, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES FROM SC5020 C5X 
INNER JOIN SC6020 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1020 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM 
AND E1X.D_E_L_E_T_='' AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA<>'' OR E1X.E1_SALDO=0)
and (E1_PARCELA='' OR E1_PARCELA='A')
WHERE C5X.D_E_L_E_T_='' 
and C5X.C5_FILIAL=A.C5_FILIAL and C5X.C5_LOCADO=A.C5_LOCADO and C5X.C5_ICBCN=A.C5_ICBCN and C5X.C5_TABELA=A.C5_TABELA 
and C6X.C6_TES=B.C6_TES and C6X.C6_TIPOOP=B.C6_TIPOOP
GROUP BY C5_FILIAL, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES) as TRB),'') AS FATURADO,
ISNULL((SELECT COUNT(*) FROM (SELECT C5_FILIAL, E1_NUM, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES, E1_VENCREA,
(Convert(nVarChar(8), GetDate()-30, 112))AS TST FROM SC5020 C5X 
INNER JOIN SC6020 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1020 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM AND C5X.D_E_L_E_T_='' AND E1X.D_E_L_E_T_=''
AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA='' OR E1X.E1_SALDO>0)
AND E1_VENCREA <= (Convert(nVarChar(8), GetDate()-30, 112))
and C5X.C5_FILIAL=A.C5_FILIAL and C5X.C5_LOCADO=A.C5_LOCADO and C5X.C5_ICBCN=A.C5_ICBCN and C5X.C5_TABELA=A.C5_TABELA 
and C6X.C6_TES=B.C6_TES and C6X.C6_TIPOOP=B.C6_TIPOOP
GROUP BY C5_FILIAL,C5_NUM,C5_LOCADO,C5_ICBCN,C6_TIPOOP, C6_TES, C5_TABELA,E1_VENCREA, E1_NUM)TRB),'') AS VENCIDO
FROM SC5020 A
INNER JOIN SC6020 B ON C5_FILIAL=C6_FILIAL AND C5_NUM=C6_NUM AND A.D_E_L_E_T_='' AND B.D_E_L_E_T_=''
INNER JOIN SX5010 C ON C.X5_TABELA='A6'AND C.X5_CHAVE=A.C5_LOCADO AND C.D_E_L_E_T_=''
INNER JOIN SX5010 D ON D.X5_TABELA='Z2'AND D.X5_CHAVE=A.C5_ICBCN AND D.D_E_L_E_T_=''
INNER JOIN SX5010 E ON E.X5_TABELA='ZE'AND E.X5_CHAVE=B.C6_TIPOOP AND E.D_E_L_E_T_=''
INNER JOIN SF4010 F ON F4_CODIGO=C6_TES AND F.D_E_L_E_T_=''
INNER JOIN DA0010 G ON DA0_CODTAB=C5_TABELA AND G.D_E_L_E_T_=''
WHERE C5_EMISSAO >= '20140101'
GROUP BY C5_FILIAL,C5_LOCADO,C5_ICBCN,C6_TIPOOP, C6_TES, C5_TABELA, C.X5_DESCRI, D.X5_DESCRI, E.X5_DESCRI,
F4_TEXTO, DA0_DESCRI, F4_DUPLIC, F4_ESTOQUE, F4_PODER3
ORDER BY EMP,C5_FILIAL,C5_LOCADO,C5_ICBCN,C6_TIPOOP, C6_TES, C5_TABELA


---ANALISTICO VENCIDO
SELECT EMP='01', C5_FILIAL, E1_NUM, E1_PREFIXO, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES, 
CONVERT(VARCHAR , CAST ( MAX(E1_VENCREA)  AS DATETIME ), 103 )E1_VENCREA
FROM SC5010 C5X 
INNER JOIN SC6010 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1010 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM 
AND C5X.D_E_L_E_T_='' AND E1X.D_E_L_E_T_=''
AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA='' OR E1X.E1_SALDO>0)
AND E1_VENCREA <= (Convert(nVarChar(8), GetDate()-30, 112))
GROUP BY C5_FILIAL,C5_NUM,E1_PREFIXO,C5_LOCADO,C5_ICBCN,C6_TIPOOP, C6_TES, C5_TABELA,E1_VENCREA, E1_NUM

UNION ALL

SELECT EMP='02', C5_FILIAL, E1_NUM, E1_PREFIXO, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES, 
CONVERT(VARCHAR , CAST ( MAX(E1_VENCREA)  AS DATETIME ), 103 )E1_VENCREA
FROM SC5020 C5X 
INNER JOIN SC6020 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1020 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM 
AND C5X.D_E_L_E_T_='' AND E1X.D_E_L_E_T_=''
AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA='' OR E1X.E1_SALDO>0)
AND E1_VENCREA <= (Convert(nVarChar(8), GetDate()-30, 112))
GROUP BY C5_FILIAL,C5_NUM,E1_PREFIXO,C5_LOCADO,C5_ICBCN,C6_TIPOOP, C6_TES, C5_TABELA,E1_VENCREA, E1_NUM

--ANALITICO FATURARO
SELECT EMP='01', C5_FILIAL, E1_NUM, E1_PREFIXO, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES
FROM SC5010 C5X 
INNER JOIN SC6010 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1010 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM 
AND E1X.D_E_L_E_T_='' AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA<>'' OR E1X.E1_SALDO=0)
and (E1_PARCELA='' OR E1_PARCELA='A')
WHERE C5X.D_E_L_E_T_='' 
GROUP BY C5_FILIAL, E1_NUM, E1_PREFIXO, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES

UNION ALL

SELECT EMP='02', C5_FILIAL, E1_NUM, E1_PREFIXO, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES
FROM SC5020 C5X 
INNER JOIN SC6020 C6X ON C6X.C6_FILIAL=C5X.C5_FILIAL AND C6X.C6_NUM=C5X.C5_NUM AND C6X.D_E_L_E_T_=''  
INNER JOIN SE1020 E1X ON E1_FILIAL=C5X.C5_FILIAL AND E1_PEDIDO=C5X.C5_NUM 
AND E1X.D_E_L_E_T_='' AND E1X.E1_EMISSAO >='20140101' AND E1X.E1_PEDIDO<>'' AND (E1X.E1_BAIXA<>'' OR E1X.E1_SALDO=0)
and (E1_PARCELA='' OR E1_PARCELA='A')
WHERE C5X.D_E_L_E_T_='' 
GROUP BY C5_FILIAL, E1_NUM, E1_PREFIXO, C5_NUM, C5_LOCADO, C5_ICBCN, C6_TIPOOP, C5_TABELA, C6_TES

