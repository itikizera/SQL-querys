--MODELO PARA IMPORTAÇÃO FOPAG

/*---------------------------
|	FUNCIONARIOS - SRA		|
---------------------------*/	
(SELECT 
	FUN.cvCodFil AS RA_FILIAL, RIGHT(FUN.ccVarFun,7) AS RA_MAT, 
(CASE FUN.cvCodCdc WHEN '2273' THEN '020101008' WHEN '2260' THEN '030101001' WHEN '2253' THEN '020201001' WHEN '2271' THEN '020201007' WHEN '2272' THEN '030101002'
WHEN '2267' THEN '020201003' WHEN '2266' THEN '020201002' WHEN '2265' THEN '020101005' WHEN '2269' THEN '020201005' WHEN '2239' THEN '010201999'
WHEN '2241' THEN '010203999' WHEN '2275' THEN '010408999' WHEN '2238' THEN '010104999' WHEN '2274' THEN '020201008' WHEN '2244' THEN '010302999'
WHEN '2276' THEN '990199001' WHEN '2242' THEN '010205999' WHEN '2247' THEN '010407999' WHEN '2237' THEN '010103999' WHEN '2243' THEN '010301999'
WHEN '2236' THEN '010101999' WHEN '2245' THEN '010401999' WHEN '2246' THEN '010402999' WHEN '2240' THEN '010202999' WHEN '2270' THEN '020201006'
WHEN '2268' THEN '020101004' WHEN '2262' THEN '020101002' WHEN '2264' THEN '020101004' WHEN '2263' THEN '020101003' WHEN '2248' THEN '020101001'
WHEN '2277' THEN '' ELSE 'XXX' END) AS RA_CC,
FUN.ccNomFun AS RA_NOME,
ISNULL(ccEndFun,'') AS RA_ENDEREC, ISNULL(ccBaiFun,'') AS RA_BAIRRO, ccCidFun AS RA_MUNICIP, 
(CASE cvUfFun WHEN '74' THEN 'MG' WHEN '123' THEN 'MT' ELSE 'SP' END) AS RA_ESTADO, ccCepFun AS RA_CEP, 
ISNULL(ccTelFun,'') AS RA_TELEFON, ISNULL(ccNomPaiFun,'') AS RA_PAI, ISNULL(ccNomMaeFun,'') AS RA_MAE, 
(CASE cvUfFun WHEN '74' THEN 'MG' WHEN '123' THEN 'MT' ELSE 'SP' END) AS RA_NATURAL, 
(CASE cvCodNac WHEN '94' THEN '45' WHEN '83' THEN '31' ELSE '10' END) AS RA_NACIONA, 
(CASE cbSexFun WHEN '0' THEN 'F' ELSE 'M' END) AS RA_SEXO, 
(CASE cvEstCiv WHEN '98' THEN 'C' WHEN '99' THEN 'S' WHEN '100' THEN 'Q' WHEN '101' THEN 'D' WHEN '103' THEN 'V' ELSE 'M' END) AS RA_ESTCIVI, 
CONVERT(VARCHAR, cdDatNasc, 112) AS RA_NASC, CONVERT(VARCHAR, FUN.cdDatAdm, 112) AS RA_ADMISSA, CONVERT(VARCHAR, FUN.cdDatAdm, 112) AS RA_OPCAO,
(CONVERT(VARCHAR,Banco.ccNumBco)+'/'+CONVERT(VARCHAR,FUN.cvcodage)) AS RA_BCDEPSA,
(CASE SUBSTRING(FUN.ccCtaCrrt ,11,1) WHEN '-' THEN RIGHT(FUN.ccCtaCrrt,7) ELSE LEFT(FUN.ccCtaCrrt,5)+'-'+UPPER(RIGHT(FUN.ccCtaCrrt,1)) END) AS RA_CTDDEPSA,
RA_HRSMES = '220', RA_HRSEMAN = '44', 
(CASE FUN.cvCodCar WHEN '2687' THEN '00001' WHEN '2321' THEN '00002' WHEN '2288' THEN '00003' WHEN '2479' THEN '00004' WHEN '2268' THEN '00005'
WHEN '2779' THEN '00006' WHEN '2417' THEN '00007' WHEN '2789' THEN '00008' WHEN '2690' THEN '00009' WHEN '2692' THEN '00010' WHEN '2788' THEN '00011'
WHEN '2786' THEN '00012' WHEN '2478' THEN '00013' WHEN '2695' THEN '00014' WHEN '2781' THEN '00015' WHEN '2598' THEN '00016' WHEN '2699' THEN '00017'
WHEN '2574' THEN '00018' WHEN '2700' THEN '00019' WHEN '2702' THEN '00020' WHEN '2670' THEN '00021' WHEN '2325' THEN '00022' WHEN '2442' THEN '00023'
WHEN '2704' THEN '00024' WHEN '2544' THEN '00025' WHEN '2686' THEN '00026' WHEN '2438' THEN '00027' WHEN '2654' THEN '00028' WHEN '2712' THEN '00029'
WHEN '2716' THEN '00030' WHEN '2432' THEN '00031' WHEN '2499' THEN '00032' WHEN '2501' THEN '00033' WHEN '2604' THEN '00034' WHEN '2767' THEN '00035' 
WHEN '2757' THEN '00036' WHEN '2726' THEN '00037' WHEN '2796' THEN '00038' WHEN '2758' THEN '00039' WHEN '2765' THEN '00040' WHEN '2568' THEN '00041'
WHEN '2794' THEN '00042' WHEN '2638' THEN '00043' WHEN '2414' THEN '00044' WHEN '2761' THEN '00045' WHEN '2362' THEN '00046' WHEN '2363' THEN '00047'
WHEN '2762' THEN '00048' WHEN '2732' THEN '00049' WHEN '2733' THEN '00050' WHEN '2631' THEN '00051' WHEN '2366' THEN '00052' WHEN '2367' THEN '00053'
WHEN '2550' THEN '00054' WHEN '2735' THEN '00055' WHEN '2737' THEN '00056' WHEN '2738' THEN '00057' WHEN '2739' THEN '00058' WHEN '2741' THEN '00059'
WHEN '2742' THEN '00060' WHEN '2421' THEN '00061' WHEN '2743' THEN '00062' WHEN '2744' THEN '00063' WHEN '2387' THEN '00064' WHEN '2760' THEN '00065'
WHEN '2764' THEN '00066' WHEN '2391' THEN '00067' WHEN '2747' THEN '00068' WHEN '2509' THEN '00069' WHEN '2755' THEN '00070' WHEN '2773' THEN '00071'
WHEN '2454' THEN '00072' WHEN '2749' THEN '00073' WHEN '2763' THEN '00074' WHEN '2791' THEN '00075' WHEN '2750' THEN '00076' WHEN '2780' THEN '00077'
WHEN '2407' THEN '00078' WHEN '2751' THEN '00079' WHEN '2752' THEN '00080' WHEN '2769' THEN '00081' WHEN '2753' THEN '00082' WHEN '2754' THEN '00083'
ELSE '' END) AS RA_CODFUNC, RA_PGCTSIN = 'T', RA_SINDICA = '01', TipSal.ccVarTipSal AS RA_CATFUNC, RA_TIPOPGT = 'M',
cvSalFun AS RA_SALARIO, cvSalFun AS RA_ANTEAUM, RA_TIPOADM = '9B', RA_VIEMRAI = '10', 
(CASE cvGrauInstr WHEN '104' THEN '20' WHEN '105' THEN '25' WHEN '106' THEN '30' WHEN '107' THEN '35' 
WHEN '108' THEN '40' WHEN '109' THEN '45' WHEN '110' THEN '50' WHEN '111' THEN '55'ELSE '55' END) AS RA_GRINRAI,
RA_TPCONTR = '1', RA_HOPARC = '2', RA_COMPSAB = '2', 
ccNumCpf AS RA_CIC, ccNumPis AS RA_PIS, ccNumRg AS RA_RG, 
SUBSTRING(ccCartPro,3,7) AS RA_NUMCP, SUBSTRING(ccCartPro,10,5) AS RA_SERCP, SUBSTRING(ccCartPro,1,2) AS RA_UFCP,
ISNULL(FUN.ccNumCnh,'') AS RA_HABILIT, ISNULL(ccNumTitElei,'') AS RA_TITULOE, 
ISNULL((ccZnTitElei+ccSesTitElei),'') AS RA_ZONASEC, 
RA_ATDPOSE = '***N**', RA_CESTAB = '01', RA_VALEREF = '01', RA_SEGUROV = '01', RA_ASSIST = '01',  Usuario.ccVarUsu AS RA_CRACHA
FROM EQUIPAV.dbo.Funcionario FUN
INNER JOIN EQUIPAV.dbo.Filial FIL ON FUN.CVCODFIL = FIL.CVCODFIL
INNER JOIN EQUIPAV.dbo.TipAdm ON TipAdm.cvCodTipAdm = FUN.cvCodTipAdm 
INNER JOIN EQUIPAV.dbo.Sindicato ON Sindicato.cvCodSind = FUN.cvCodSind
INNER JOIN EQUIPAV.dbo.Cargo ON Cargo.cvCodCar = FUN.cvCodCar
INNER JOIN EQUIPAV.dbo.TipSal ON TipSal.cvCodTipSal = FUN.cvCodTipSal
INNER JOIN EQUIPAV.dbo.Usuario ON Usuario.cvCodFun = FUN.cvCodFun
INNER JOIN Banco ON Banco.cvCodBco = FUN.cvCodBco
WHERE FUN.cdDatRes IS NULL 
ORDER BY RA_MAT, FUN.ccVarFun, RA_FILIAL)

/*---------------------------
|	DEPENDENTES	- SRB		|
---------------------------*/	
(SELECT
	Funcionario.cvCodFil AS RB_FILIAL,  
ROW_NUMBER() OVER(PARTITION BY Dependente.cvCodFun ORDER BY Dependente.CVCODFUN) AS RB_COD,
RIGHT(Funcionario.ccVarFun,7) AS RB_MAT, Dependente.ccNomDep AS RB_NOME, 
CONVERT(VARCHAR, Dependente.cdDatNascDep, 112) AS RB_DTNASC, 
(CASE Dependente.cbSexDep WHEN '0' THEN 'F' ELSE 'M' END) AS RB_SEXO,
(CASE Dependente.cvGrauPrnt WHEN '144' THEN '1' WHEN '145' THEN '1' WHEN '139' THEN '2' ELSE '4' END) AS RB_TIPIR,
(CASE Dependente.cvDepSalFml WHEN '3' THEN '1' WHEN '1' THEN '2' ELSE '2' END) AS RB_TIPSF,
(CASE Dependente.cvGrauPrnt WHEN '144' THEN 'C' WHEN '145' THEN 'C' WHEN '139' THEN 'F' WHEN '154' THEN 'E'  
	WHEN '141' THEN 'P' WHEN '142' THEN 'P' ELSE 'O' END) AS RB_GRAUPAR, ISNULL(Dependente.ccNumCpfDep,'') AS RB_CIC
FROM Dependente
INNER JOIN Funcionario ON Funcionario.cvCodFun = Dependente.cvCodFun
INNER JOIN EQUIPAV.dbo.Filial FIL ON Funcionario.CVCODFIL = FIL.CVCODFIL
WHERE Funcionario.cdDatRes IS NULL)

/*-----------------------------------------------------------
|	AFASTAMENTOS, FASE 1 - AFASTSR8							|
|															|
|REALIZAR A EXPORTAÇÃO PARA OUTRA TABELA, PARA QUE A FUNÇÃO	|
|ROW NUMBER SEJA EXECUTADA CORRETAMENTE PARA O CAMPO R8_COD	|
-----------------------------------------------------------*/
(SELECT * INTO AFASTSR8 FROM (
SELECT FUN.cvCodFil AS R8_FILIAL, RIGHT(FUN.ccVarFun,7) AS R8_MAT, FUN.ccNomFun,
CONVERT(VARCHAR, Afastamento.cdDatIniAfa, 112) AS R8_DATA,
Afastamento.cvCodTipAfa AS R8_TIPO,
CONVERT(VARCHAR, Afastamento.cdDatIniAfa, 112) AS R8_DATAINI, 
ISNULL(CONVERT(VARCHAR, Afastamento.cdDatFimAfa, 112),'') AS R8_DATAFIN,
ISNULL(day(Afastamento.cdDatFimAfa - Afastamento.cdDatIniAfa),'') AS  R8_DURACAO,
ISNULL(Afastamento.cvCodRHCid10,'') AS R8_CID FROM Afastamento
INNER JOIN Funcionario FUN ON FUN.cvCodFun = Afastamento.cvCodFun AND FUN.cvCodFun = Afastamento.cvCodFun AND FUN.cdDatRes IS NULL
INNER JOIN EQUIPAV.dbo.Filial FIL ON FUN.CVCODFIL = FIL.CVCODFIL
UNION 
SELECT FUN.cvCodFil AS R8_FILIAL, RIGHT(FUN.ccVarFun,7) AS RA_MAT, FUN.ccNomFun,
CONVERT(VARCHAR, HistFer.cdDatIniFer, 112) AS R8_DATA,
R8_TIPO = '99',
CONVERT(VARCHAR, HistFer.cdDatIniFer, 112) AS R8_DATAINI, 
CONVERT(VARCHAR, (HistFer.cdDatIniFer + HistFer.cvDiaFer), 112) AS R8_DATAFIN, 
HistFer.cvDiaFer AS  R8_DURACAO, R8_CID = '0' FROM HistFer
INNER JOIN Funcionario FUN ON FUN.cvCodFun = HistFer.cvCodFun AND FUN.cvCodFun = HistFer.cvCodFun AND FUN.cdDatRes IS NULL
INNER JOIN EQUIPAV.dbo.Filial FIL ON FUN.CVCODFIL = FIL.CVCODFIL
WHERE YEAR(HistFer.cdDatIniFer) >= 2012) AS TBR))

/*-----------------------------------------------------------
|	AFASTAMENTOS, FASE 2 - SR8								|
|															|
|APÓS A IMPORTAÇÃO DOS REGISTROS PARA A TB AFASTSR8 CONFORME|
|FASE 1 DA QUARY DE AFASTAMENTO								|
-----------------------------------------------------------*/
( SELECT 
R8_FILIAL, R8_MAT, R8_DATA, 
ROW_NUMBER() OVER(PARTITION BY R8_MAT ORDER BY R8_MAT) AS R8_SEQ,
(CASE R8_TIPO WHEN '1' THEN 'P' WHEN '2' THEN 'O' WHEN '3' THEN 'Q' WHEN '4' THEN 'R' WHEN '5' THEN 'W'
	WHEN '5' THEN 'Q' WHEN '7' THEN 'X' WHEN '8' THEN '1' WHEN '13' THEN '8' WHEN '99' THEN 'F' ELSE 'Y' END) AS R8_TIPO, 
R8_DATAINI,
(CASE 
	WHEN R8_TIPO = '99' THEN CONVERT(VARCHAR,DATEADD(DAY, -1, R8_DATAFIN),112)
	ELSE R8_DATAFIN END) AS R8_DATAFIM,  R8_DURACAO,
(CASE 
	WHEN R8_TIPO= '1' AND R8_DURACAO <= '15' THEN R8_DURACAO
	WHEN R8_TIPO= '1' AND R8_DURACAO >= '15' THEN '15'
	WHEN R8_TIPO= '2' AND R8_DURACAO <= '15' THEN R8_DURACAO 
	WHEN R8_TIPO= '2' AND R8_DURACAO >= '15' THEN '15'
	WHEN R8_TIPO= '10' AND R8_DURACAO <= '15' THEN R8_DURACAO
	WHEN R8_TIPO= '10' AND R8_DURACAO >= '15' THEN '15'
	WHEN R8_TIPO= '3' OR  R8_TIPO= '6' THEN R8_DURACAO
	ELSE '' END) AS R8_DIASEMP, R8_CID FROM AFASTSR8)

/*-----------------------------------------------------------
|	VERBAS - SRV											|
|															|
|FILTRO DAS VERBAS QUE FORAM UTILIZADAS PÓS 2012			|
|LANÇADO EM EXCEL PARA IMPORTAÇÃO VIA DBF					|
-----------------------------------------------------------*/	
(SELECT 
	Evento.cvCodEve, Evento.ccNomEve, Evento.ccAbrEve, Escolha.ccNomEscl FROM Evento
INNER JOIN Escolha ON Escolha.cvCodEscl = Evento.cvTipEve
WHERE cvCodEve IN (SELECT DISTINCT(cvCodEve) FROM FicFin WHERE cvAnoFicFin >= 2012)
AND Evento.cvCodEve NOT IN (SELECT cvCodEve FROM Evento WHERE ccNomEve LIKE '%RECIBO%')
ORDER BY ccNomEscl DESC,ccNomEve)

/*---------------------------
|	ACUMULADOS - SRD		|
---------------------------*/	

(SELECT FUN.cvCodFil AS RD_FILIAL, RIGHT(FUN.ccVarFun,7) AS RD_MAT, FicFin.cvCodEve, 
(CASE FicFin.cvCodEve
WHEN	'0008'	THEN	'011' WHEN	'0051'	THEN	'013' WHEN	'0270'	THEN	'015' WHEN	'0172'	THEN	'016' WHEN	'0621'	THEN	'020'
WHEN	'0283'	THEN	'024' WHEN	'0036'	THEN	'030' WHEN	'0943'	THEN	'036' WHEN	'0782'	THEN	'037' WHEN	'1324'	THEN	'040' 
WHEN	'1635'	THEN	'041' WHEN	'0175'	THEN	'050' WHEN	'0096'	THEN	'052' WHEN	'0842'	THEN	'054' WHEN	'0836'	THEN	'057'
WHEN	'1437'	THEN	'060' WHEN	'1641'	THEN	'061' WHEN	'0353'	THEN	'063' WHEN	'1571'	THEN	'064' WHEN	'0029'	THEN	'066'
WHEN	'1573'	THEN	'067' WHEN	'0776'	THEN	'081' WHEN	'0980'	THEN	'086' WHEN	'1024'	THEN	'088' WHEN	'0176'	THEN	'092'
WHEN	'0061'	THEN	'094' WHEN	'0099'	THEN	'100' WHEN	'0123'	THEN	'101' WHEN	'0703'	THEN	'116' WHEN	'0865'	THEN	'121' 
WHEN	'1025'	THEN	'123' WHEN	'0791'	THEN	'174' WHEN	'0014'	THEN	'301' WHEN	'0057'	THEN	'302' WHEN	'0016'	THEN	'304'
WHEN	'0058'	THEN	'305' WHEN	'0658'	THEN	'306' WHEN	'1621'	THEN	'307' WHEN	'0015'	THEN	'309' WHEN	'0059'	THEN	'310' 
WHEN	'0657'	THEN	'311' WHEN	'0212'	THEN	'315' WHEN	'1118'	THEN	'317' WHEN	'0066'	THEN	'319' WHEN	'0009'	THEN	'325'  
WHEN	'0010'	THEN	'324' WHEN	'0017'	THEN	'336' WHEN	'0738'	THEN	'340' WHEN	'0739'	THEN	'341' WHEN	'0840'	THEN	'344'
WHEN	'0213'	THEN	'351' WHEN	'0007'	THEN	'361' WHEN	'0044'	THEN	'362' WHEN	'1215'	THEN	'364' 
WHEN	'1630'	THEN (CASE WHEN FicFin.cvVlrFimFicFin IN (SELECT MAX(FIC2.cvVlrFimFicFin) FROM FicFin AS FIC2
WHERE FIC2.cvCodEve = '1630' GROUP BY FIC2.cvCodFun,FIC2.cvCodEve, 
(CONVERT(VARCHAR,FIC2.cvAnoFicFin)+ RIGHT('00' + RTRIM(FIC2.cvMesFicFin),2))) THEN '385' 
WHEN FicFin.cvVlrFimFicFin IN (SELECT MIN(FIC3.cvVlrFimFicFin) FROM FicFin AS FIC3
WHERE FIC3.cvCodEve = '1630' GROUP BY FIC3.cvCodFun,FIC3.cvCodEve, 
(CONVERT(VARCHAR,FIC3.cvAnoFicFin)+ RIGHT('00' + RTRIM(FIC3.cvMesFicFin),2))) THEN 'Z63'ELSE 'Z63' END)
WHEN	'0006'	THEN	'400' WHEN	'0025'	THEN	'401' WHEN	'0075'	THEN	'402' WHEN	'0084'	THEN	'403' WHEN	'0217'	THEN	'404'
WHEN	'0076'	THEN	'405' WHEN	'0026'	THEN	'411' WHEN	'0077'	THEN	'412' WHEN	'0052'	THEN	'413' WHEN	'0018'	THEN	'415'
WHEN	'0078'	THEN	'421' WHEN	'0079'	THEN	'422' WHEN	'0043'	THEN	'431' WHEN	'0115'	THEN	'432' WHEN	'0280'	THEN	'433'
WHEN	'1441'	THEN	'434' WHEN	'0743'	THEN	'442' WHEN	'0048'	THEN	'451' WHEN	'0373'	THEN	'461' WHEN	'1628'	THEN	'464' 
WHEN	'0060'	THEN	'470' WHEN	'0174'	THEN	'471' WHEN	'0700'	THEN	'474' WHEN	'1327'	THEN	'476' WHEN	'1085'	THEN	'477'
WHEN	'1643'	THEN	'478' WHEN	'0277'	THEN	'480' WHEN	'1103'	THEN	'481' WHEN	'1644'	THEN	'482' WHEN	'1591'	THEN	'490'
WHEN	'0368'	THEN	'492' WHEN	'0198'	THEN	'493' WHEN	'0042'	THEN	'495' WHEN	'0211'	THEN	'501' WHEN	'0050'	THEN	'507'
WHEN	'0263'	THEN	'517' WHEN	'0294'	THEN	'520' WHEN	'0236'	THEN	'523' WHEN	'1457'	THEN	'525' WHEN	'1645'	THEN	'Z01'
WHEN	'1646'	THEN	'Z02' WHEN	'0642'	THEN	'Z03' 
WHEN	'1631'	THEN (CASE WHEN FicFin.cvVlrFimFicFin IN (SELECT MAX(FIC4.cvVlrFimFicFin) FROM FicFin AS FIC4
WHERE FIC4.cvCodEve = '1631' GROUP BY FIC4.cvCodFun,FIC4.cvCodEve, 
(CONVERT(VARCHAR,FIC4.cvAnoFicFin)+ RIGHT('00' + RTRIM(FIC4.cvMesFicFin),2))) THEN 'Z04'
WHEN FicFin.cvVlrFimFicFin IN (SELECT MIN(FIC5.cvVlrFimFicFin) FROM FicFin AS FIC5
WHERE FIC5.cvCodEve = '1631' GROUP BY FIC5.cvCodFun,FIC5.cvCodEve, 
(CONVERT(VARCHAR,FIC5.cvAnoFicFin)+ RIGHT('00' + RTRIM(FIC5.cvMesFicFin),2))) THEN 'Z64' ELSE 'Z04' END) 
WHEN	'0074'	THEN	'Z05' WHEN	'0022'	THEN	'Z06'
WHEN	'0209'	THEN	'Z07' WHEN	'0665'	THEN	'Z08' WHEN	'0167'	THEN	'Z09' WHEN	'0027'	THEN	'Z10' WHEN	'1150'	THEN	'Z11'
WHEN	'1414'	THEN	'Z12' WHEN	'0820'	THEN	'Z13' WHEN	'1544'	THEN	'Z14' WHEN	'1632'	THEN	'Z15' WHEN	'0845'	THEN	'Z16'
WHEN	'0063'	THEN	'Z17' WHEN	'0281'	THEN	'Z18' WHEN	'1548'	THEN	'Z19' WHEN	'0039'	THEN	'Z20' WHEN	'1647'	THEN	'Z21'
WHEN	'1642'	THEN	'Z22' WHEN	'1648'	THEN	'Z23' WHEN	'0944'	THEN	'Z24' WHEN	'0178'	THEN	'Z25' WHEN	'0219'	THEN	'Z26'
WHEN	'0011'	THEN	'Z27' WHEN	'0091'	THEN	'Z28' WHEN	'1409'	THEN	'Z29' WHEN	'1226'	THEN	'Z30' WHEN	'1192'	THEN	'Z31'
WHEN	'0625'	THEN	'Z32' WHEN	'0122'	THEN	'Z33' WHEN	'1627'	THEN	'Z34' WHEN	'1509'	THEN	'Z35' WHEN	'1036'	THEN	'Z36'
WHEN	'1054'	THEN	'Z37' WHEN	'1636'	THEN	'Z38' WHEN	'1653'	THEN	'Z39' WHEN	'0227'	THEN	'Z40' WHEN	'0249'	THEN	'Z41'
WHEN	'1634'	THEN	'Z42' WHEN	'1652'	THEN	'Z43' WHEN	'1655'	THEN	'Z44' WHEN	'1656'	THEN	'Z45' WHEN	'1328'	THEN	'Z46'
WHEN	'0231'	THEN	'Z47' WHEN	'1547'	THEN	'Z48' WHEN	'1624'	THEN	'Z49' WHEN	'1422'	THEN	'Z50' WHEN	'1065'	THEN	'Z51'
WHEN	'1089'	THEN	'Z52' WHEN	'0181'	THEN	'486' WHEN	'0184'	THEN	'Z54'  WHEN	'1649'	THEN	'Z55' WHEN	'1640'	THEN	'Z56'
WHEN	'1546'	THEN	'Z57' WHEN	'1453'	THEN	'Z58' WHEN	'1106'	THEN	'Z59' WHEN	'0019'	THEN	'Z60' WHEN	'1651'	THEN	'Z61'
WHEN	'0684'	THEN	'Z62' WHEN '0001' 	THEN 	'657' ELSE 'XXX' END) AS RD_PD,
( CASE WHEN FicFin.cvCodEve IN (SELECT cvCodEve FROM Evento
WHERE ccNomEve LIKE '%HORA%' OR ccNomEve LIKE '%EXTRA%' OR ccNomEve LIKE '%DSR%' OR ccNomEve LIKE '%H.E.%'
OR ccNomEve LIKE '%HRS%') THEN 'H' ELSE 'V' END) AS RD_TIPO1,
FicFin.cvVlrBasFicFin AS RD_HORAS, FicFin.cvVlrFimFicFin AS RD_VALOR ,
(CONVERT(VARCHAR,FicFin.cvAnoFicFin)+ RIGHT('00' + RTRIM(FicFin.cvMesFicFin),2)) AS RD_DATARQ,
(CONVERT(VARCHAR,FicFin.cvAnoFicFin)+ RIGHT('00' + RTRIM(FicFin.cvMesFicFin),2)+'20') AS RD_DATPGT,
(CASE FUN.cvCodCdc WHEN '2273' THEN '020101008' WHEN '2260' THEN '030101001' WHEN '2253' THEN '020201001' WHEN '2271' THEN '020201007' WHEN '2272' THEN '030101002'
WHEN '2267' THEN '020201003' WHEN '2266' THEN '020201002' WHEN '2265' THEN '020101005' WHEN '2269' THEN '020201005' WHEN '2239' THEN '010201999'
WHEN '2241' THEN '010203999' WHEN '2275' THEN '010408999' WHEN '2238' THEN '010104999' WHEN '2274' THEN '020201008' WHEN '2244' THEN '010302999'
WHEN '2276' THEN '990199001' WHEN '2242' THEN '010205999' WHEN '2247' THEN '010407999' WHEN '2237' THEN '010103999' WHEN '2243' THEN '010301999'
WHEN '2236' THEN '010101999' WHEN '2245' THEN '010401999' WHEN '2246' THEN '010402999' WHEN '2240' THEN '010202999' WHEN '2270' THEN '020201006'
WHEN '2268' THEN '020101004' WHEN '2262' THEN '020101002' WHEN '2264' THEN '020101004' WHEN '2263' THEN '020101003' WHEN '2248' THEN '020101001'
WHEN '2277' THEN '' ELSE 'XXX' END) AS RD_CC,
RD_TIPO2 = 'I', (RIGHT('00' + RTRIM(FicFin.cvMesFicFin),2)) AS RD_MES, RD_STATUS = 'A'
FROM FicFin
INNER JOIN Funcionario FUN ON FUN.cvCodFun = FicFin.cvCodFun AND FUN.cdDatRes IS NULL
INNER JOIN Evento ON Evento.cvCodEve = FicFin.cvCodEve AND Evento.cvTipEve IN ('48','49','50')
WHERE FicFin.cvAnoFicFin >= '2012'
AND FicFin.cvCodEve IN ('0001', '0008', '0051', '0270', '0172', '0621', '0283', '0036', '0943', '0782', '1324', '1635', '0175', '0096', '0842', '0836', '1437', '1641', '0353', 
'0980', '1024', '0176', '0061', '0099', '0123', '0703', '0865', '1025', '0791', '0014', '0057', '0016', '0058', '0658', '1621', '0015', '0059', '0657', '0212', '1118', 
'0066', '0009', '0010', '0017', '0738', '0739', '0840', '0213', '0007', '0044', '1215', '1630', '0006', '0025', '0075', '0084', '0217', '0076', '0026', '0077', '0052', 
'0018', '0078', '0079', '0043', '0115', '0280', '1441', '0743', '0048', '0373', '1628', '0060', '0174', '0700', '1327', '1085', '1643', '0277', '1103', '1644', '1591', 
'0368', '0198', '0042', '0211', '0050', '0263', '0294', '0236', '1457', '1645', '1646', '0642', '1631', '0074', '0022', '0209', '0665', '0167', '0027', '1150', '1414', 
'0820', '1544', '1632', '0845', '0063', '0281', '1548', '0039', '1647', '1642', '1648', '0944', '0178', '0219', '0011', '0091', '1409', '1226', '1192', '0625', '0122', 
'1627', '1509', '1036', '1054', '1636', '1653', '0227', '0249', '1634', '1652', '1655', '1656', '1328', '0231', '1547', '1624', '1422', '1065', '1089', '0181', '0184', 
'1571', '0029', '1573', '0776', '1649', '1640', '1546', '1453', '1106', '0019', '1651', '0684')
ORDER BY RD_MAT, RD_DATARQ, RD_PD)



/*---------------------------
|	PER AQUISITIVO - SRF	|
---------------------------*/	
(SELECT FUN.cvCodFil AS RF_FILIAL, RIGHT(FUN.ccVarFun,7) AS RF_MAT, 
MAX(CONVERT(VARCHAR, PerAqsFer.cdDatIniPerAqsFer, 112)) AS RF_DATABAS,
CASE WHEN(DATEDIFF(month, MAX(PerAqsFer.cdDatIniPerAqsFer), GETDATE())* 2.5) <= 30
		THEN DATEDIFF(month, MAX(PerAqsFer.cdDatIniPerAqsFer), GETDATE())* 2.5 
	 WHEN (DATEDIFF(month, MAX(PerAqsFer.cdDatIniPerAqsFer), GETDATE())* 2.5) > 30 
		THEN 30
	 ELSE ''
	 END AS RF_DFERAAT,
CASE WHEN(DATEDIFF(month, MAX(PerAqsFer.cdDatIniPerAqsFer), GETDATE())* 2.5) > 30 
		THEN ((DATEDIFF(month, MAX(PerAqsFer.cdDatIniPerAqsFer), GETDATE())* 2.5)-30) 
	 ELSE 0
	 END AS RF_DFERVAT
FROM PerAqsFer
INNER JOIN Funcionario FUN ON FUN.cvCodFun = PerAqsFer.cvCodFun AND FUN.cdDatRes IS NULL
INNER JOIN Usuario ON Usuario.cvCodFun = FUN.cvCodFun
GROUP BY FUN.cvCodFil, FUN.ccVarFun, FUN.ccNomFun, PerAqsFer.cvDiaDirFer



SELECT cvCodBco, cvcodage, Funcionario.ccNomFun,
CASE SUBSTRING(ccCtaCrrt ,11,1) WHEN '-' THEN RIGHT(ccCtaCrrt,7) ELSE RIGHT(ccCtaCrrt,11) END FROM Funcionario
WHERE cdDatRes IS NULL 
ORDER BY cvCodBco
)

SELECT Banco.ccNumBco, cvcodage, Funcionario.ccNomFun,
(CASE SUBSTRING(ccCtaCrrt ,11,1) WHEN '-' THEN RIGHT(ccCtaCrrt,7) ELSE LEFT(ccCtaCrrt,5)+'-'+UPPER(RIGHT(ccCtaCrrt,1)) END) AS  FROM Funcionario